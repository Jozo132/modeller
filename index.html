<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2D DXF Modeller</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Toolbar -->
  <div id="toolbar">
    <div class="tool-group">
      <button id="btn-new" title="New Drawing (Ctrl+N)"><svg viewBox="0 0 20 20"><path d="M4 2h8l4 4v12H4V2z"/><path d="M12 2v4h4" fill="none"/></svg></button>
      <button id="btn-open" title="Open DXF"><svg viewBox="0 0 20 20"><path d="M2 16V6h5l2 2h7v8H2z"/></svg></button>
      <button id="btn-save" title="Save DXF (Ctrl+S)"><svg viewBox="0 0 20 20"><path d="M4 2h10l4 4v10a2 2 0 01-2 2H4a2 2 0 01-2-2V4a2 2 0 012-2z"/><rect x="6" y="2" width="8" height="6" rx="0.5"/><rect x="5" y="12" width="10" height="5" rx="0.5"/></svg></button>
    </div>
    <div class="toolbar-sep"></div>
    <div class="tool-group">
      <span class="group-label">Draw</span>
      <button id="btn-line" title="Line (L)" data-tool="line"><svg viewBox="0 0 20 20"><line x1="3" y1="17" x2="17" y2="3"/></svg></button>
      <button id="btn-rect" title="Rectangle (R)" data-tool="rectangle"><svg viewBox="0 0 20 20"><rect x="3" y="5" width="14" height="10" fill="none"/></svg></button>
      <button id="btn-circle" title="Circle (C)" data-tool="circle"><svg viewBox="0 0 20 20"><circle cx="10" cy="10" r="7" fill="none"/></svg></button>
      <button id="btn-arc" title="Arc (A)" data-tool="arc"><svg viewBox="0 0 20 20"><path d="M4 16A9 9 0 0116 4" fill="none"/></svg></button>
      <button id="btn-polyline" title="Polyline (P)" data-tool="polyline"><svg viewBox="0 0 20 20"><polyline points="2,16 7,4 13,14 18,3" fill="none"/></svg></button>
      <button id="btn-text" title="Text (T)" data-tool="text"><svg viewBox="0 0 20 20"><text x="4" y="16" font-size="15" font-weight="700" fill="currentColor" stroke="none">T</text></svg></button>
      <button id="btn-dimension" title="Dimension (D)" data-tool="dimension"><svg viewBox="0 0 20 20"><line x1="3" y1="14" x2="17" y2="14"/><line x1="3" y1="11" x2="3" y2="17"/><line x1="17" y1="11" x2="17" y2="17"/><polygon points="5,13 3,14 5,15" fill="currentColor" stroke="none"/><polygon points="15,13 17,14 15,15" fill="currentColor" stroke="none"/></svg></button>
    </div>
    <div class="toolbar-sep"></div>
    <div class="tool-group">
      <span class="group-label">Edit</span>
      <button id="btn-select" title="Select (Esc)" data-tool="select"><svg viewBox="0 0 20 20"><path d="M5 2l10 8-5 1-2 5z"/></svg></button>
      <button id="btn-move" title="Move (M)" data-tool="move"><svg viewBox="0 0 20 20"><path d="M10 2l3 3h-2v4h4V7l3 3-3 3v-2h-4v4h2l-3 3-3-3h2v-4H5v2L2 10l3-3v2h4V5H7z"/></svg></button>
      <button id="btn-copy" title="Copy (Ctrl+D)" data-tool="copy"><svg viewBox="0 0 20 20"><rect x="6" y="2" width="10" height="12" rx="1" fill="none"/><rect x="3" y="6" width="10" height="12" rx="1" fill="none"/></svg></button>
      <button id="btn-trim" title="Trim (X)" data-tool="trim"><svg viewBox="0 0 20 20"><line x1="2" y1="10" x2="18" y2="10"/><line x1="10" y1="3" x2="10" y2="17" stroke-dasharray="2,2"/><line x1="11" y1="10" x2="18" y2="10" stroke="var(--text-secondary)" stroke-width="2"/></svg></button>
      <button id="btn-split" title="Split (K)" data-tool="split"><svg viewBox="0 0 20 20"><line x1="2" y1="10" x2="8" y2="10"/><line x1="12" y1="10" x2="18" y2="10"/><circle cx="10" cy="10" r="2" fill="currentColor" stroke="none"/></svg></button>
      <button id="btn-delete" title="Delete (Del)"><svg viewBox="0 0 20 20"><polyline points="5,6 7,17 13,17 15,6" fill="none"/><line x1="3" y1="6" x2="17" y2="6"/><path d="M8 3h4v3H8z" fill="none"/></svg></button>
      <button id="btn-undo" title="Undo (Ctrl+Z)"><svg viewBox="0 0 20 20"><path d="M4 10c0-4 3-7 7-7s7 3 7 7-3 7-7 7" fill="none"/><polygon points="2,10 5,7 5,13" fill="currentColor" stroke="none"/></svg></button>
      <button id="btn-redo" title="Redo (Ctrl+Y)"><svg viewBox="0 0 20 20"><path d="M16 10c0-4-3-7-7-7S2 6 2 10s3 7 7 7" fill="none"/><polygon points="18,10 15,7 15,13" fill="currentColor" stroke="none"/></svg></button>
    </div>
    <div class="toolbar-sep"></div>
    <div class="tool-group">
      <span class="group-label">Constrain</span>
      <button id="btn-coincident" title="Coincident" data-tool="coincident"><svg viewBox="0 0 20 20"><circle cx="10" cy="10" r="3" fill="currentColor" stroke="none"/><circle cx="10" cy="10" r="6" fill="none"/></svg></button>
      <button id="btn-horizontal" title="Horizontal" data-tool="horizontal"><svg viewBox="0 0 20 20"><line x1="3" y1="10" x2="17" y2="10"/><text x="3" y="7" font-size="6" fill="currentColor" stroke="none">H</text></svg></button>
      <button id="btn-vertical" title="Vertical" data-tool="vertical"><svg viewBox="0 0 20 20"><line x1="10" y1="3" x2="10" y2="17"/><text x="12" y="8" font-size="6" fill="currentColor" stroke="none">V</text></svg></button>
      <button id="btn-parallel" title="Parallel" data-tool="parallel"><svg viewBox="0 0 20 20"><line x1="3" y1="7" x2="17" y2="7"/><line x1="3" y1="13" x2="17" y2="13"/></svg></button>
      <button id="btn-perpendicular" title="Perpendicular" data-tool="perpendicular"><svg viewBox="0 0 20 20"><line x1="3" y1="17" x2="3" y2="3"/><line x1="3" y1="17" x2="17" y2="17"/><rect x="3" y="12" width="5" height="5" fill="none"/></svg></button>
      <button id="btn-distance" title="Fixed Distance" data-tool="distance"><svg viewBox="0 0 20 20"><circle cx="5" cy="10" r="2" fill="currentColor" stroke="none"/><circle cx="15" cy="10" r="2" fill="currentColor" stroke="none"/><line x1="7" y1="10" x2="13" y2="10" stroke-dasharray="2,2"/></svg></button>
      <button id="btn-lock" title="Lock Point" data-tool="lock"><svg viewBox="0 0 20 20"><rect x="4" y="9" width="12" height="9" rx="1.5" fill="none"/><path d="M7 9V6a3 3 0 016 0v3" fill="none"/></svg></button>
      <button id="btn-equal" title="Equal Length" data-tool="equal"><svg viewBox="0 0 20 20"><line x1="3" y1="8" x2="17" y2="8"/><line x1="3" y1="12" x2="17" y2="12"/></svg></button>
      <button id="btn-tangent" title="Tangent" data-tool="tangent"><svg viewBox="0 0 20 20"><circle cx="8" cy="10" r="5" fill="none"/><line x1="13" y1="4" x2="13" y2="16"/></svg></button>
      <button id="btn-angle" title="Angle" data-tool="angle"><svg viewBox="0 0 20 20"><line x1="3" y1="17" x2="17" y2="17"/><line x1="3" y1="17" x2="12" y2="5"/><path d="M8 17 A5 5 0 0 1 6.5 13" fill="none"/><text x="9" y="15" font-size="6" fill="currentColor" stroke="none">∠</text></svg></button>
    </div>
    <div class="toolbar-sep"></div>
    <div class="tool-group">
      <span class="group-label">Ops</span>
      <button id="btn-disconnect" title="Disconnect Point" data-tool="disconnect"><svg viewBox="0 0 20 20"><circle cx="7" cy="10" r="2.5" fill="none"/><circle cx="13" cy="10" r="2.5" fill="none"/><line x1="4" y1="4" x2="16" y2="16" stroke-dasharray="2,2"/></svg></button>
      <button id="btn-union" title="Union / Join Points" data-tool="union"><svg viewBox="0 0 20 20"><circle cx="7" cy="10" r="2.5" fill="none"/><circle cx="13" cy="10" r="2.5" fill="none"/><path d="M9 8l2 2-2 2" fill="none"/></svg></button>
    </div>
    <div class="toolbar-sep"></div>
    <div class="tool-group">
      <button id="btn-zoom-fit" title="Fit All (F)"><svg viewBox="0 0 20 20"><rect x="3" y="3" width="14" height="14" rx="1" fill="none"/><polyline points="3,8 3,3 8,3" fill="none"/><polyline points="12,3 17,3 17,8" fill="none"/><polyline points="17,12 17,17 12,17" fill="none"/><polyline points="8,17 3,17 3,12" fill="none"/></svg></button>
      <button id="btn-zoom-in" title="Zoom In (+)"><svg viewBox="0 0 20 20"><circle cx="9" cy="9" r="5" fill="none"/><line x1="13" y1="13" x2="17" y2="17"/><line x1="7" y1="9" x2="11" y2="9"/><line x1="9" y1="7" x2="9" y2="11"/></svg></button>
      <button id="btn-zoom-out" title="Zoom Out (-)"><svg viewBox="0 0 20 20"><circle cx="9" cy="9" r="5" fill="none"/><line x1="13" y1="13" x2="17" y2="17"/><line x1="7" y1="9" x2="11" y2="9"/></svg></button>
      <button id="btn-grid-toggle" title="Toggle Grid (G)"><svg viewBox="0 0 20 20"><line x1="7" y1="2" x2="7" y2="18"/><line x1="13" y1="2" x2="13" y2="18"/><line x1="2" y1="7" x2="18" y2="7"/><line x1="2" y1="13" x2="18" y2="13"/></svg></button>
      <button id="btn-snap-toggle" title="Snap (S)" class="active"><svg viewBox="0 0 20 20"><circle cx="10" cy="10" r="4" fill="none"/><circle cx="10" cy="10" r="1.5" fill="currentColor" stroke="none"/><line x1="10" y1="2" x2="10" y2="6"/><line x1="10" y1="14" x2="10" y2="18"/><line x1="2" y1="10" x2="6" y2="10"/><line x1="14" y1="10" x2="18" y2="10"/></svg></button>
      <button id="btn-ortho-toggle" title="Ortho (O)"><svg viewBox="0 0 20 20"><line x1="3" y1="17" x2="3" y2="3"/><line x1="3" y1="17" x2="17" y2="17"/><text x="6" y="14" font-size="9" fill="currentColor" stroke="none">90</text></svg></button>
    </div>
  </div>

  <!-- Properties Panel -->
  <div id="properties-panel">
    <h3>Properties</h3>
    <div id="properties-content">
      <p class="hint">Select an entity to view properties</p>
    </div>
    <hr />
    <h3>Layers</h3>
    <div id="layers-panel">
      <div class="layer-row active-layer" data-layer="0">
        <span class="layer-color" style="background:#fff"></span>
        <span class="layer-name">0</span>
        <button class="layer-visibility" title="Toggle visibility">&#128065;</button>
      </div>
    </div>
    <button id="btn-add-layer" title="Add Layer">+ Layer</button>
  </div>

  <!-- Left Panel (Primitives & Constraints) -->
  <div id="left-panel">
    <div id="primitives-section">
      <h3>Primitives</h3>
      <div id="primitives-list"></div>
    </div>
    <hr />
    <div id="constraints-section">
      <h3>Constraints <span id="constraints-filter-badge" class="filter-badge" style="display:none" title="Filtered by selection">⊘</span></h3>
      <div id="constraints-list"></div>
    </div>
    <hr />
    <div id="variables-section">
      <h3>Variables</h3>
      <div id="variables-list"></div>
      <button id="btn-add-variable" title="Add Variable">+ Variable</button>
    </div>
  </div>

  <!-- Canvas -->
  <canvas id="cad-canvas"></canvas>

  <!-- Status Bar -->
  <div id="status-bar">
    <span id="status-tool">Tool: Select</span>
    <span id="status-coords">X: 0.00 Y: 0.00</span>
    <span id="status-snap">SNAP</span>
    <span id="status-ortho">ORTHO</span>
    <span id="status-message"></span>
  </div>

  <!-- Command Line -->
  <div id="command-line">
    <label for="cmd-input">Command:</label>
    <input type="text" id="cmd-input" placeholder="Type command..." autocomplete="off" />
  </div>

  <!-- Hidden file input -->
  <input type="file" id="file-input" accept=".dxf" style="display:none" />

  <!-- Reusable popup modal -->
  <div id="app-modal-root" class="app-modal-root" aria-hidden="true"></div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
